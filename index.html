<!DOCTYPE HTML>
<html>
	<head>
		<meta charset = "UTF-8">
		<title>yourcommute</title>
		
		<link rel="stylesheet" href="lib/animate.css/animate.min.css" />
		<link rel="stylesheet" href="lib/normalize.css/normalize.css" />
		<link rel="stylesheet" href="lib/font-awesome/css/font-awesome.min.css" />
		<link rel="stylesheet" href="css/temp.css" />
		<link rel="stylesheet" href="css/styles.css" />
		<link rel="stylesheet" href="css/map.css" />
		

		
		<script src="lib/jquery/jquery.min.js"></script>
		<script src="lib/jquery-cookie/src/jquery.cookie.js"></script>
		<script src="lib/FitText.js/jquery.fittext.js"></script>
		<script src="lib/jquery.transit/jquery.transit.js"></script>
		<script src="js/ajax.js"></script>
		<script src="js/script.js"></script>
		<script src="js/resize.js"></script>
		<script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgjJ8ZIxlOYpJ9WNfgtLgCjlEQ2Mf_GRE&libraries=places&v=3.exp">
      </script>
		
	</head>
	
	
	<body>
		<div id = "background"></div>
		<div id = "container">
		
			<div id = "header">
				<h1>yourcommu<i class="fa fa-tree"></i>e</h1>
			</div>

			<div id = "logon">
				<a href = "php/login.php" class = "facebook_link"> <i class="fa fa-facebook-square"></i> Log in With Facebook</a>
			</div>
			
			<div id="post-login" style="display:none;">
				<!---This div doesn't appear until the user has logged in---->
				<script>
				    var directionsDisplay;
    var directionsService = new google.maps.DirectionsService();
    var map;
    var check_load = false;
    var waypts = [];
    var check_no_input = true;
    var startloc = new google.maps.LatLng(51.5000, 0.1167);
    var carbon_p_km = 160;
    var kmpg = 30 * 1.609344;
    var p_litre = 130;

    function initialize() {
      var mapOptions = {
        zoom:13,
        center: startloc,
        streetViewControl:false
      }
      var rendererOptions = {
        draggable: true
      };
      map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
      directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
      if (navigator.geolocation) {
         navigator.geolocation.getCurrentPosition(function (position) {
             startloc = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
             map.setCenter(startloc);
         });
     }

      directionsDisplay.setMap(map);

      google.maps.event.addListener(directionsDisplay, 'directions_changed', function() {
        computeTotalDistance(directionsDisplay.getDirections());
      });
      calcRoute();

      var start_auto = document.getElementById('start');
      var end_auto = document.getElementById('end');
      autocomplete = new google.maps.places.Autocomplete(start_auto);
      autocomplete2 = new google.maps.places.Autocomplete(end_auto);

      google.maps.event.addListener(map,'click',function(event){
        if (check_load == true) {
          var lat = event.latLng.lat();
          var lng = event.latLng.lng();
          waypts.push({
            location:new google.maps.LatLng(lat, lng),
            stopover:true
        });
          calcRoute();
        }
      });

      $(document).ready(function() {
        $(document).keydown(function(e) {
          if (check_no_input == true) {
          var key = e.which
          if (key == 68) {
          waypts = [];
          calcRoute();
        }
        }
        });
        $(".instyle").focus(function(){
          check_no_input = false;
        });
        $(".instyle").focusout(function(){
          check_no_input = true;
      });
      });
    }

    function calcRoute() {
      var start = document.getElementById("start").value;
      var end = document.getElementById("end").value;
      var transport = document.getElementById("transport").value;
      $("#calcroute").click(function() {
        $("#prop").fadeIn("slow");
      });
      if (transport == "TRANSIT") {
        check_load = false;
        waypts = [];
      }
      var request = {
        origin:start,
        destination:end,
        travelMode: google.maps.TravelMode[transport],
        waypoints: waypts
      };
      directionsService.route(request, function(response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
          directionsDisplay.setDirections(response);
          check_load = true;
        }
      });
    }
    function computeTotalDistance(result) {
      var total = 0;
      var myroute = result.routes[0];
      for (i = 0; i < myroute.legs.length; i++) {
        total += myroute.legs[i].distance.value;
      }
      total = total / 1000.
      var total_co2 = total * carbon_p_km;
      var money_saved = (total / kmpg) * 4.54609 * (p_litre / 100);
      money_saved = Math.floor(money_saved * 100) / 100;
      if (money_saved.toString().length == 3) {
        money_saved = money_saved.toFixed(2);
      }
      document.getElementById("total").innerHTML = total + " km";
      document.getElementById("total_c").innerHTML = total_co2 + " g";
      document.getElementById("money_save").innerHTML = "&pound;" + money_saved;
    }
    google.maps.event.addDomListener(window, 'load', initialize);
				</script>
				<form action="#">
					start:<input type="text" id="start" class="instyle"><br />
					end:<input type="text" id="end" class="instyle"><br />
					<select id="transport">
					  <option value="DRIVING">Drive</option>
					  <option value="BICYCLING">Cycle</option>
					  <option value="TRANSIT">Public transport route</option>
					  <option value="WALKING">Walk</option>
					</select>
					<input type="button" value="Calculate route" onclick="calcRoute();" id="calcroute">
					</form>
					<div id="map-canvas" style="float:left;width:70%; height:100%"></div>
					<div id="prop">
					<p class="">Total Distance: <span id="total"></span></p>
					<p>Total carbon: <span id="total_c"></span></p>
					<p>Fuel Cost: <span id="money_save"></span></p>
					</div>
				<h2 id="profile-name">John Doe</h1>
				
			</div>
			
		</div>
		
		<div id="footer">
			
		</div>
	</body>
</html>